# 技术栈研究

下面是我为你定制的 **最终版技术栈方案文档（InfluxDB + FastAPI + WebSocket + ECharts）**，结构清晰、可读性强、便于你未来开发和写进论文/开题报告。

它也保留了 **前端未来升级到 Vue / React 的扩展性**。

我会用专业文档格式撰写，适合作为你项目的正式技术文档。

---

# 📘 **空气质量实时可视化平台 技术栈方案（最终版）**

**InfluxDB + FastAPI + WebSocket + ECharts（可扩展到 Vue/React）**

版本：v1.0

---

# 1. 项目目标概述

构建一个**空气质量实时数据流展示平台**，支持：

- 从本地 CSV 数据集导入历史空气质量数据
- 存入 **InfluxDB** 时间序列数据库
- 使用 **FastAPI** 启动后端服务
- 使用 **WebSocket** 实时推送数据到前端
- 前端使用 **ECharts** 实时渲染曲线图与监控面板
- 保留将前端升级到 **Vue 或 React** 的可能性

数据实际原始粒度为“1 小时一次”，通过后端以一定速度模拟“实时流”。

---

# 2. 系统整体架构

```
          ┌──────────────┐
          │   前端页面    │  HTML + JS + ECharts
          └───────┬──────┘
                  │ WebSocket（实时推流）
┌─────────────────▼────────────────┐
│            FastAPI 后端           │
│  - WebSocket 推流服务             │
│  - 历史查询 REST API（可选）      │
│  - 从 InfluxDB 读取数据           │
└─────────────────┬────────────────┘
                  │
                  │ HTTP API（Flux 查询）
          ┌───────▼──────┐
          │   InfluxDB   │
          │ 时间序列数据库 │
          └───────────────┘

```

---

# 3. 技术栈选型

## ⭐ 3.1 后端技术栈（核心）

| 技术 | 用途 | 原因 |
| --- | --- | --- |
| **FastAPI** | 提供 API、WebSocket | 高性能、语法简洁、生态成熟 |
| **FastAPI WebSocket** | 实现实时数据推送 | 适合实时场景 |
| **InfluxDB 2.x** | 存储空气质量时间序列数据 | 高效查询时间戳数据 |
| **InfluxDB Python Client** | 后端读取数据 | 官方支持，语法简单 |
| **Python + Pandas** | 导入 CSV 数据 | 简单可靠，适合数据预处理 |
| **uvicorn** | 运行 FastAPI | 高性能 ASGI 服务器 |

---

## ⭐ 3.2 前端技术栈（初始版本）

| 技术 | 用途 | 原因 |
| --- | --- | --- |
| **HTML + CSS** | 前端结构 | 最小可行化实现 |
| **JavaScript** | WebSocket + 图表逻辑 | 无构建工具即可运行 |
| **ECharts** | 绘制实时图表 | 强大易用，适合监控仪表盘 |

---

## ⭐ 3.3 前端未来可扩展方向（可选）

为了支持未来你想升级前端：

| 技术 | 用途 | 说明 |
| --- | --- | --- |
| **Vue 3 + Vite** | 更专业的前端 | 更易入门、生态适合国内 |
| **React + Vite** | 工程化最强 | 更适合大项目 |

升级方式：

- WebSocket 接收逻辑保持不变
- ECharts 可以直接嵌入到 Vue/React 组件中
    
    → **不会破坏现有架构**
    

---

# 4. 数据流说明

## 🔄 数据导入流程（一次性）

1. 读取本地 CSV（1 小时粒度）
2. 使用 Python 脚本写入 InfluxDB
3. 数据以 measurement + timestamp 储存

示例 measurement 结构：

```
measurement: aqi
tags: { station_id: "001" }
fields: { pm25: 32, pm10: 51, co2: 430 }
timestamp: 2024-01-01T01:00:00Z
```

---

## 🔁 模拟实时数据流流程

FastAPI 每秒：

1. 从 InfluxDB 查询下一条记录
2. 通过 WebSocket 推送到前端
3. 若播放到尾部，则循环

可加入 **加速因子**（1 小时 → N 秒）：

```python
await asyncio.sleep(ACCELERATION_FACTOR)
```

---

# 5. 后端整体模块设计

## 5.1 模块结构建议（最终版）

```
backend/
  ├── app/
  │   ├── main.py            # FastAPI 入口
  │   ├── websocket.py       # WebSocket 推流
  │   ├── influx_client.py   # 数据库连接
  │   ├── data_loader.py     # CSV → InfluxDB 导入
  │   ├── config.py          # 配置项
  │   └── utils.py
  ├── requirements.txt
  └── README.md
```

---

# 6. 前端结构设计

最基础的前端：

```
frontend/
  ├── index.html
  ├── app.js
  ├── style.css
  └── echarts.min.js
```

ECharts 实时图表：

- PM2.5 实时折线图
- PM10 实时折线图
- CO2 折线或仪表盘
- 可扩展多图布局

---

# 7. 后端 API 设计

## 7.1 WebSocket（实时数据流）

```
ws://localhost:8000/ws/stream
```

推送消息格式：

```json
{
  "timestamp": "2024-01-01T01:00:00Z",
  "pm25": 35,
  "pm10": 48,
  "co2": 430
}
```

---

## 7.2 REST API（可选）

### 获取某时间窗口数据

```
GET /api/history?start=...&end=...
```

---

# 8. 部署方案

## 8.1 开发环境（建议）

- Python 3.10+
- InfluxDB 本地 Docker
- Node（可选，未来升级 Vue/React 用）

## 8.2 Docker 部署（生产）

`docker-compose.yml`：

- InfluxDB
- FastAPI（uvicorn）
- Nginx（托管前端静态页面）

---

# 9. 项目未来扩展方向（留接口）

| 功能 | 扩展难度 | 描述 |
| --- | --- | --- |
| 前端升级为 Vue/React | ⭐⭐ | 支持组件化开发 |
| 多站点多传感器数据 | ⭐ | Measurement + tag 模型即可扩展 |
| 热力图/地图展示 | ⭐⭐ | 使用 Amap/Leaflet |
| 用户登录/权限 | ⭐⭐⭐ | FastAPI + JWT |
| 动态告警系统 | ⭐⭐ | 当 PM2.5 超阈值触发事件 |

---

# 10. 方案总结（可用于 PPT / 答辩）

✔ **InfluxDB**：存储与高效查询时间序列空气质量数据

✔ **FastAPI**：高性能后端框架，负责 API 和 WebSocket

✔ **WebSocket**：实现实时数据流推送

✔ **ECharts**：前端实时可视化（折线图、仪表盘）

✔ **可扩展到 Vue/React**：架构不变，只升级前端层

✔ **数据可循环播放 + 加速倍率控制**：模拟真实监控场景

✔ **整套系统轻量、清晰、可拓展性强**

---

# 🧠 5. 扩展功能（未来可加）

- AQI 颜色映射（绿→黄→橙→红→紫）
- 24 小时滚动窗口
- 多传感器对比（多个折线）
- 加入预测模型（GRU / TinyML）
- 告警规则（AQI > 150 自动报警）
- 地图热力图（Leaflet + ECharts）

> 考虑到您的项目具有**硕士课题**的性质，其价值在于您**自定义的预测模型集成**和**高性能的后端逻辑**（FastAPI/InfluxDB）。
> 
> 
> **最省力且高质量的路线是：**
> 
> 1. **后端：** 按照您自己的设计，用 **FastAPI + InfluxDB** 从零开始构建 `websocket.py` 和 `influx_client.py`（这是课题核心）。
> 2. **前端：** 寻找一个现成的 **Vue/React + ECharts 模板**，并将其数据层替换为连接您的 **FastAPI WebSocket**。
> 
> 这样既利用了开源项目快速搭建了专业的前端界面，又保证了后端核心逻辑和课题创新点的自主性。
>